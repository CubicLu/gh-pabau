## Paths

- `/prisma/` contains the latest ```schema.prisma```  which lets us map and manipulate our current mariadb database using an
  object-oriented paradigm
- `/src/app/` contains the core business logic
- `/src/generated/` auto generated files by running ```yarn bridge:generate```
- `/src/middlewares/` GraphQl & Express.js middlewares
- `/src/schema/types/` All bespoke nexus objects not automatically generated by ```yarn bridge:generate``` should be placed there


# Running the bridge locally

Prerequisites: Locally setup docker env && hasura docker image & docker desktop running (for Windows users)
- Pull the latest build from our master branch ```git pull origin master```
- If additional ORM mappings are required, implement the necessary changes at ```schema.prisma```
- ```yarn bridge:generate``` to generate the files after successful changes
- ```yarn nx serve bridge-api``` to run bridge-api in dev mode

# Testing locally
```bash
yarn && yarn nx deploy bridge-api && docker build --no-cache -t bridge -f tools/cicd/bridge.Dockerfile dist/apps/bridge-api/ && docker run --rm -it -p 4000:4000 bridge
```

# Exposing GraphQL CRUD over a database table

Most of the time ORM remapping should be handled the following way

1.  Successful changes on the `schema.prisma`
2. `prisma validate` to ensure no typos/errors exist in our `schema.prisma`
3. `yarn bridge:generate`

In rare instances if errors arise 

1. `prisma validate`
2. `yarn bridge:prune`
3. `prisma format`
4. `prisma generate`
5. `pal g`
6. `pal schema typescript -o apps/bridge-api/src/generated`
7. `ts-node-dev --transpile-only apps/bridge-api/src/schema`

To ensure that the graphql queries/mutations where exposed properly
`nx serve bridge-api`

# Adjusting schema.prisma changes to our database

1. prepare migrate.sql file 
2. adjust `schema.prisma` models/create new model with the newly desired changes
3. ran the steps outlined at `Exposing GraphQL CRUD over a database table`

# Doing database modification 
# [until introspect is implemented]

# Adding a new model field that maps to a newly created database column
1. Inside `apps/bridge-api/prisma/schema.prisma` locate the model that should be amended
2. Example: `company_id  Int     @map("occupier")` if the db 

# Relevant third-party modules documentation

- prisma ```https://www.prisma.io/docs/concepts/components```
- nexus ```https://nexusjs.org/docs/```
- pal.js ```https://paljs.com/```
- hasura ```https://hasura.io/docs/latest/graphql/core/getting-started/docker-simple.html```
